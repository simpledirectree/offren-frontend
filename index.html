<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Loading Directory...</title>
    <meta name="description" content="Find local services in your area" id="page-description">
    <meta name="keywords" content="local services, directory" id="page-keywords">

    <!-- Open Graph meta tags -->
    <meta property="og:title" content="Loading..." id="og-title">
    <meta property="og:description" content="Find local services in your area" id="og-description">
    <meta property="og:type" content="website">
    <meta property="og:url" content="" id="og-url">

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- Styles -->
    <link rel="stylesheet" href="/assets/styles.css">

    <!-- Preconnect to API -->
    <link rel="preconnect" href="https://offren-api.hf.space">
</head>
<body>
    <!-- Loading State -->
    <div id="loading" class="loading-container">
        <div class="container">
            <div class="loading-content">
                <div class="spinner"></div>
                <h1>Loading Directory...</h1>
                <p>Please wait while we fetch the latest listings</p>
            </div>
        </div>
    </div>

    <!-- Error State -->
    <div id="error" class="error-container" style="display: none;">
        <div class="container">
            <div class="error-content">
                <h1>Directory Not Found</h1>
                <p id="error-message">The requested directory could not be found.</p>
                <div class="error-actions">
                    <a href="https://simpledirectree.com" class="btn btn-primary">‚Üê Back to Main Site</a>
                    <button onclick="location.reload()" class="btn btn-secondary">Try Again</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Homepage Content -->
    <div id="homepage" class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <h1>Offren Directories</h1>
                    <p>Find and compare local services in your area</p>
                    <div class="header-subtitle">
                        <span>Unlimited directories ‚Ä¢ $0/month ‚Ä¢ No setup fees</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <h2>Discover Local Services</h2>
                    <p>Browse our comprehensive directory of local
                    businesses and services. From plumbing to roofing, find trusted
                    professionals in your area.</p>

                    <!-- Search Box -->
                    <div class="hero-search">
                        <input type="text" id="global-search" placeholder="Search for services (plumbing, electricians, roofing...)" autocomplete="off">
                        <button onclick="performGlobalSearch()" class="btn btn-primary">Search</button>
                    </div>
                </div>
            </div>
        </section>


        <!-- Features Section -->
        <section id="features-section" class="features-section">
            <div class="container">
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üìä</div>
                        <h3>Comprehensive Listings</h3>
                        <p>Detailed business information with reviews, ratings, and contact details</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üîç</div>
                        <h3>Easy Search</h3>
                        <p>Find exactly what you're looking for with our powerful search and filtering</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üì±</div>
                        <h3>Mobile Friendly</h3>
                        <p>Access directories on any device with our responsive design</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">‚ö°</div>
                        <h3>Fast & Reliable</h3>
                        <p>Lightning-fast loading with global CDN and caching</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üÜì</div>
                        <h3>Free Forever</h3>
                        <p>Unlimited directories at no cost - no setup fees, no monthly charges</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üîÑ</div>
                        <h3>Always Updated</h3>
                        <p>Automatic updates ensure you always have the latest business information</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-links">
                        <a href="https://simpledirectree.com">Offren</a>
                        <a href="https://simpledirectree.com/about">About</a>
                        <a href="mailto:hello@simpledirectree.com">Add Your Business</a>
                        <a href="https://github.com/simpledirectree" target="_blank">GitHub</a>
                    </div>
                    <div class="footer-meta">
                        <span>¬© 2024 Offren Directories</span>
                        <span>‚Ä¢</span>
                        <span>Powered by <a href="https://simpledirectree.com" target="_blank">Offren</a></span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Directory Content -->
    <div id="content" class="main-content" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <h1 id="directory-title">Directory</h1>
                    <p id="directory-description">Find local services in your area</p>
                    <div class="directory-stats">
                        <span id="directory-stats">üìä Loading...</span>
                        <span id="last-updated">üïí Recently updated</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Filters -->
        <section class="filters-section">
            <div class="container">
                <div class="filters">
                    <div class="search-box">
                        <input
                            type="text"
                            id="search"
                            placeholder="Search by name, location, or service..."
                            onkeyup="filterListings()"
                            autocomplete="off"
                        >
                        <span class="search-icon">üîç</span>
                    </div>

                    <div class="results-count">
                        <span id="results-count">Showing all listings</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Listings -->
        <section class="listings-section">
            <div class="container">
                <div id="listings" class="listings-grid">
                    <!-- Listings will be populated by JavaScript -->
                </div>

                <div id="no-results" class="no-results" style="display: none;">
                    <h3>No listings found</h3>
                    <p>Try adjusting your search terms or filters.</p>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-links">
                        <a href="https://simpledirectree.com">Offren</a>
                        <a href="https://simpledirectree.com/about">About</a>
                        <a href="mailto:hello@simpledirectree.com">Add Your Business</a>
                    </div>
                    <div class="footer-meta">
                        <span id="footer-updated">Updated recently</span>
                        <span>‚Ä¢</span>
                        <span>Powered by <a href="https://simpledirectree.com" target="_blank">Offren</a></span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="/assets/directory-loader.js"></script>
    <script>
        // Only run loadDirectories() on the homepage
        if (window.location.pathname === '/') {
            document.addEventListener('DOMContentLoaded', async () => {
                await loadDirectories();
            });
        }

        async function loadDirectories() {
            try {
                const response = await fetch('/api/registry');
                const data = await response.json();

                const featuresSection = document.getElementById('features-section');

                if (data.directories && data.directories.length > 0) {
                    const html = data.directories.map(slug => `
                        <div class="directory-card">
                            <h3>${formatDirectoryName(slug)}</h3>
                            <p>Find ${formatDirectoryName(slug).toLowerCase()} in your area</p>
                            <a href="/${slug}" class="btn btn-secondary">Browse Directory</a>
                        </div>
                    `).join('');

                    featuresSection.innerHTML = `
                        <div class="container">
                            <div class="directories-grid">
                                ${html}
                            </div>
                        </div>
                    `;
                }
                // If no directories or empty, leave features section as is
            } catch (error) {
                console.error('Failed to load directories:', error);
                // Leave features section as is on error
            }
        }

        function formatDirectoryName(slug) {
            return slug.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function performGlobalSearch() {
            const query = document.getElementById('global-search').value.trim();
            if (query) {
                // Redirect to search page or perform search
                window.location.href = `/search?q=${encodeURIComponent(query)}`;
            }
        }

        // Allow search on Enter key
        document.getElementById('global-search').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                performGlobalSearch();
            }
        });
    </script>

    <!-- Schema.org structured data -->
    <script type="application/ld+json" id="structured-data">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Loading...",
        "description": "Find local services in your area"
    }
    </script>
</body>
</html>
